#!/usr/bin/env node
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("axios"),require("fs"),require("csv-parse"),require("validator"),require("minimist")):"function"==typeof define&&define.amd?define(["axios","fs","csv-parse","validator","minimist"],e):e(t.axios,t.fs,t.parse,t.validator,t.minimist)}(this,function(t,e,n,r,i){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n,i=i&&i.hasOwnProperty("default")?i.default:i;var o=function(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function r(i,o){try{var s=e[i](o),a=s.value}catch(t){return void n(t)}if(!s.done)return Promise.resolve(a).then(function(t){r("next",t)},function(t){r("throw",t)});t(a)}("next")})}},s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};let a=(u=o(function*(e){let n=e.host,r=e.username,i=e.password;return(yield t.post(`http://${n}/wp-json/jwt-auth/v1/token`,{username:r,password:i},{headers:{"Content-Type":"application/json"}})).data}),function(t){return u.apply(this,arguments)});var u;let c=(l=o(function*(e){var n=yield e;const r=n.existingData,i=function(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}(n,["existingData"]),o=this[P].token,s=JSON.stringify(i),a={headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}},u=r?this[m]+r.id:this[m];yield t.post(u,s,a).catch(function(t){return console.error(t.response)})}),function(t){return l.apply(this,arguments)});var l;let p=(f=o(function*(e){const n=`${this[m]}?per_page=50&search=${e.fields.name}`,r=(yield t.get(n)).data.filter(function(t){return"contact_info"===t.type})[0];return s({},e,{existingData:r})}),function(t){return f.apply(this,arguments)});var f;const d=Symbol("Personnel File"),h=Symbol("Valid personnel records"),y=Symbol("WordPress Client"),m=Symbol("Personnel API Route"),v=Symbol("Advanced Custom Field Route"),P=Symbol("JWT for WP API");function w(t,e){if("PHONE"===e[1])return t.push([e]),t;const n=t.pop();return n.push(e),t.push(n),t}function b(t){return{office:t[0],personnel:t.slice(1).filter(t=>r.isEmail(t[5]))}}function j(t){const e=t.office;return t.personnel.map(t=>{const n=`${e[0]}\nPO Box 501370 CK\nSaipan MP, 96950`,r=t[0].split(",")[0];return{title:r,status:"publish",fields:{address:n,name:r,telephone:t.slice(1,4).filter(t=>t.trim().length>0).join(", "),fax:t[4],email:t[5],job_title:(t[0].split(",").slice(1)||[""]).join(",").trim()}}})}let O=(()=>{var t=o(function*(){const t=new class{constructor(t){this[d]=e.readFileSync("personnel.csv",{encoding:"utf-8"}),this[y]=t,this[m]=`http://${t.host}/wp-json/wp/v2/contact_info/`,this[v]=`http://${t.host}/wp-json/acf/v3/contact_info/`}parse(){var t=this;return o(function*(){const e=t[d],r=yield new Promise(function(t,r){n(e,{},function(e,n){e&&r(e),t(n)})});t[h]=yield r.reduce(w,[]).map(b).map(j).reduce(function(t,e){return[...t,...e]},[])})()}post(){var t=this;return o(function*(){t[P]=yield a(t[y]),t[h].map(p.bind(t)).map(c.bind(t))})()}}(x);yield t.parse(),yield t.post()});return function(){return t.apply(this,arguments)}})();const x=JSON.parse(e.readFileSync("contactUploader.json"));O()});
